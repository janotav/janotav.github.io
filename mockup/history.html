<html>
<head>
<link rel="manifest" href="manifest.json">
<meta name="viewport" content="user-scalable=no"/>
<script src="https://use.fontawesome.com/dd6ad41192.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<style media="screen" type="text/css">

    html {
        font-size: 40px;
    }

    body {
        background: #000000;
        color: #FFFFFF;
        margin: 8px;
    }

    select {
        font-size: 1em;
    }

    .history_page {
    }

    div.history_select {
        padding-left: 20px;
        padding-right: 20px;
    }

    .history_select {
        display: inline-block;
    }

    .invisible {
        display: none;
    }

    div.select_item {
        display: inline;
    }

    .history_header {
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        padding-left: 10px;
        padding-top: 10px;
        background: black;
    }

</style>
</head>
<script>

    var emission_idx = [
        "undetermined",
        "incomplete",
        "very_good",
        "good",
        "satisfactory",
        "acceptable",
        "bad",
        "very_bad"];

    var qualityLabel = {
        "undetermined": "Nestanovuje se",
        "incomplete": "Neúplná data",
        "very_good": "Velmi dobrá",
        "good": "Dobrá",
        "satisfactory": "Uspokojivá",
        "acceptable": "Vyhovující",
        "bad": "Špatná",
        "very_bad": "Velmi špatná"
    };

    window.onload = function() {
        var charts = [];

        var ctxIdx = $("#myChart_idx");
        var myChartIdx = new Chart(ctxIdx, {
            type: 'bar',
            data: {
                labels: ["15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00", "22:00", "23:00", "0:00", "1:00", "2:00", "3:00", "4:00", "5:00", "6:00", "7:00", "8:00", "9:00", "10:00", "11:00", "12:00", "13:00", "14:00"],
                datasets: [{
                    label: 'dobra',
                    data: [5, 5, 2, 2, 2, 3, 3, 1, 3, 3, 2, 3, 3, 5, 5, 5, 3, 3, 4, 5, 5, 2, 3, 3],
                    backgroundColor: [
                        '#ED1C24',
                        '#ED1C24',
                        '#9BD3AE',
                        '#9BD3AE',
                        '#9BD3AE',
                        '#FFF200',
                        '#FFF200',
                        '#9BD3AE',
                        '#FFF200',
                        '#FFF200',
                        '#FFF200',
                        '#FFF200',
                        '#ED1C24',
                        '#ED1C24',
                        '#ED1C24',
                        '#ED1C24',
                        '#FFF200',
                        '#FFF200',
                        '#ED1C24',
                        '#ED1C24',
                        '#ED1C24',
                        '#9BD3AE',
                        '#FFF200',
                        '#FFF200'
                    ]
                }]
            },
            options: {
                tooltips: {
                    callbacks: {
                        label: function (tooltipItems, data) {
                            return qualityLabel[emission_idx[tooltipItems.yLabel + 1]];
                        }
                    }
                },
                legend: {
                    display: false
                },
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero:true
                        }
                    }]
                }
            }
        });

        var ctxNO2 = $("#myChart_NO2");
        var myChartNO2 = new Chart(ctxNO2, {
            type: 'bar',
            data: {
                labels: ["15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00", "22:00", "23:00", "0:00", "1:00", "2:00", "3:00", "4:00", "5:00", "6:00", "7:00", "8:00", "9:00", "10:00", "11:00", "12:00", "13:00", "14:00"],
                datasets: [{
                    label: 'µg/m³',
                    data: [46.3, 42.3, 17, 17.6, 19.3, 29.5, 25.6, 10, 24.5, 23.1, 19.7, 20.9, 33.3, 41.9, 43, 40.9, 28.5, 29.3, 36.0, 46.3, 42.3, 19.3, 29.5, 25.6],
                    backgroundColor: [
                        '#ED1C24',
                        '#ED1C24',
                        '#9BD3AE',
                        '#9BD3AE',
                        '#9BD3AE',
                        '#FFF200',
                        '#FFF200',
                        '#9BD3AE',
                        '#FFF200',
                        '#FFF200',
                        '#FFF200',
                        '#FFF200',
                        '#ED1C24',
                        '#ED1C24',
                        '#ED1C24',
                        '#ED1C24',
                        '#FFF200',
                        '#FFF200',
                        '#ED1C24',
                        '#ED1C24',
                        '#ED1C24',
                        '#9BD3AE',
                        '#FFF200',
                        '#FFF200'
                    ]
                }]
            },
            options: {
                legend: {
                    display: false
                },
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero:true
                        }
                    }]
                }
            }
        });

        charts.push({ elem: $("#myChart_idx"), name: "Index kvality" });
        charts.push({ elem: $("#myChart_NO2"), name: "Oxid dusičitý" });

        var win = $(window);
        var history_charts = $("#history_charts");
        var history_measurement = $("#history_measurement");

        updateMeasurementName();
        win.scroll(function() {
            updateMeasurementName();
        });

        function updateMeasurementName() {
            var max = 0;
            var name;
            charts.forEach(function (chart) {
                var visibility = calculateVisibility(chart.elem);
                if (visibility > max) {
                    max = visibility;
                    name = chart.name;
                }
            });
            history_measurement.text(name);
        }

        function calculateVisibility(elem) {
            var visible_y_min = win.scrollTop() + history_charts.offset().top;
            var visible_y_max = win.scrollTop() + window.innerHeight;

            var idx_y_min = elem.offset().top;
            var idx_y_max = idx_y_min + elem.height();
            return Math.max(0, Math.min(idx_y_max, visible_y_max) - Math.max(idx_y_min, visible_y_min));
        }
    };
</script>
<body>
<div id="history_page" class="history_page">
    <div class="history_header">
        Praha 4-Libuš

        <div id="history_period" class="history_select">
            <div class="select_item"><span>24 hodin</span></div>
            <div class="invisible"><span>týden</span></div>
            <div class="invisible"><span>měsíc</span></div>
            <i class="fa fa-bars history_select" aria-hidden="true"></i>
        </div>

        <div id="history_measurement" class="history_select"></div>
    </div>
    <div id="history_header_placeholder" style="height: 50px;"></div>
    <div id="history_charts">
        <div>
            <canvas id="myChart_idx"></canvas>
        </div>

        <div>
            <canvas id="myChart_NO2"></canvas>
        </div>

        <canvas id="myChart3"></canvas>
    </div>
</div>
</body>
</html>
